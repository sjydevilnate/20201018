<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Document</title>

        <link rel="stylesheet" href="../css/reset.css" />
    </head>

    <body>
        <xmp>
        1. react 플러그인 include 또는 임포트
        3. Action 과  Action Creator 만들기
        4. Reducer 만들기.
        5. Store 만들기
        6. subscribe 만들기
        7. dispatch 만들기
        </xmp>

        <script type="text/x-template"></script>
    </body>
</html>

<!-- react 플러그인 include   -->
<!-- 주의: 사이트를 배포할 때는 "development.js"를 "production.min.js"로 대체하세요. -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.12.0/umd/react.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.11.0/umd/react-dom.development.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.5/redux.js">
    /* redux import */
</script>
<script type="text/babel">
    // 임포트 선언. 플러그인 방식에서는 필요 없음.
    console.log(React);
    console.log(React.Component);
    console.log(ReactDOM);
    console.log(Redux);

    debugger;
    //import React from "react";
    //const { render } = ReactDOM; // <==> import { render } from "react-dom";
    //const { createStore } = Redux; // <==> import { createStore} from 'redux';

    const initialState = {
        task: "",
        tasks: [],
    };

    function tasksReducer(state = initialState, action) {
        switch (action.type) {
            case "INPUT_TASK":
                return {
                    ...state,
                    task: action.payload.task,
                };
            case "ADD_TASK":
                return {
                    ...state,
                    tasks: state.tasks.concat([action.payload.task]),
                };
            default:
                return state;
        }
    }

    const store = Redux.createStore(tasksReducer);

    const inputTask = (task) => ({
        type: "INPUT_TASK",
        payload: {
            task,
        },
    });

    const addTask = (task) => ({
        type: "ADD_TASK",
        payload: {
            task,
        },
    });

    class TodoApp extends React.Component {
        // 초기값 설정
        state = {};
        constructor(props) {
            super(props);

            //const { task, tasks } = props.getState();

            // this 설정
        }
        render() {
            return (
                <div>
                    <input
                        type="text"
                        onChange={(e) =>
                            store.dispatch(inputTask(e.target.value))
                        }
                    />
                    <input
                        type="button"
                        value="add"
                        onClick={() => store.dispatch(addTask(task))}
                    />
                    <ul></ul>
                </div>
            );
        }
    }

    function TodoApp2({ store }) {
        const { task, tasks } = store.getState();
        return (
            <div>
                <input
                    type="text"
                    onChange={(e) => store.dispatch(inputTask(e.target.value))}
                />
                <input
                    type="button"
                    value="add"
                    onClick={() => store.dispatch(addTask(task))}
                />
                <ul>
                    {tasks.map(function (item, i) {
                        return <li key={i}>{item}</li>;
                    })}
                </ul>
            </div>
        );
    }

    function renderApp(store) {
        ReactDOM.render(
            <TodoApp store={store} />,
            document.getElementById("root")
        );
    }

    store.subscribe(() => renderApp(store));
    renderApp(store);
</script>
